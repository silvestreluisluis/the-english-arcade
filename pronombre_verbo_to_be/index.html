<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Juego de Aprendizaje de Ingl√©s - Todos los Niveles</title>
  <style>
    /* Estilos generales */
    body {
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      background-color: #f5f5f5;
      padding: 20px;
      margin: 0;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    h1 {
      font-size: 2.2rem;
      color: #2a9d8f;
      margin-bottom: 20px;
    }
    
    /* Navegaci√≥n entre niveles */
    .level-nav {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .level-btn {
      padding: 10px 15px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
      background-color: #ccc;
      color: white;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .level-btn.active {
      background-color: #2a9d8f;
      cursor: pointer;
    }
    
    .level-btn.inactive {
      background-color: #ccc;
      cursor: not-allowed;
    }
    
    /* Estilos comunes para todos los niveles */
    #game-box {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin: auto;
    }
    
    .image-box {
      font-size: 4rem;
      margin: 10px 0;
    }
    
    .riddle, .sentence, .story {
      font-size: 1.1rem;
      margin-bottom: 15px;
      color: #333;
      line-height: 1.6;
    }
    
    .options button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 1.2rem;
      border-radius: 8px;
      border: none;
      color: white;
      cursor: pointer;
    }
    
    #feedback {
      font-weight: bold;
      font-size: 1.2rem;
      margin-top: 15px;
    }
    
    #score, #final-score {
      font-size: 1rem;
      margin-top: 10px;
      color: #555;
    }
    
    #final-score {
      font-size: 1.3rem;
      color: #283618;
      font-weight: bold;
    }
    
    #next-btn, #retry-btn, #verify-btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1rem;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    
    /* Estilos espec√≠ficos para cada nivel */
    /* Nivel 1 */
    .level1 .options button {
      background-color: #dda15e;
    }
    
    .level1 .options button:hover {
      background-color: #bc6c25;
    }
    
    .level1 #next-btn, .level1 #retry-btn {
      background-color: #606c38;
    }
    
    .level1 {
      background-color: #fefae0;
    }
    
    /* Nivel 2 */
    .level2 .options button {
      background-color: #2a9d8f;
    }
    
    .level2 .options button:hover {
      background-color: #21867a;
    }
    
    .level2 #next-btn, .level2 #retry-btn, .level2 #level3-btn {
      background-color: #264653;
    }
    
    .level2 {
      background-color: #eaf4f4;
    }
    
    /* Nivel 3 */
    .level3 .options button {
      background-color: #e76f51;
    }
    
    .level3 .options button:hover {
      background-color: #d65a3a;
    }
    
    .level3 #next-btn, .level3 #retry-btn, .level3 #level4-btn {
      background-color: #264653;
    }
    
    .level3 {
      background-color: #fff3e0;
    }
    
    /* Nivel 4 */
    .level4 select {
      font-size: 1rem;
      padding: 5px 10px;
      margin: 0 5px;
    }
    
    .level4 #verify-btn, .level4 #retry-btn {
      background-color: #3a86ff;
    }
    
    .level4 #verify-btn:hover, .level4 #retry-btn:hover {
      background-color: #2f6fd6;
    }
    
    .level4 {
      background-color: #f0f4ff;
    }
    
    /* Calificaci√≥n final */
    #final-grade {
      margin-top: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      border-radius: 12px;
      color: white;
      display: none;
    }
    
    .grade-value {
      font-size: 3rem;
      font-weight: bold;
      margin: 10px 0;
    }
    
    .grade-message {
      font-size: 1.2rem;
      margin-bottom: 15px;
    }
    
    /* Ocultar niveles no activos */
    .level {
      display: none;
    }
    
    .level.active {
      display: block;
    }
  </style>
</head>
<script>
  function sendHeight() {
    const height = document.documentElement.scrollHeight;
    parent.postMessage(height, "*");
  }

  window.addEventListener("load", sendHeight);
  window.addEventListener("resize", sendHeight);

  // Por si el contenido cambia din√°micamente
  setInterval(sendHeight, 500);
</script>
<body>
  <div class="container">
    <h1>Juego de Aprendizaje de Ingl√©s</h1>
    
    <div class="level-nav">
      <button id="btn-level1" class="level-btn active" onclick="showLevel(1)">Nivel 1</button>
      <button id="btn-level2" class="level-btn inactive" onclick="showLevel(2)">Nivel 2</button>
      <button id="btn-level3" class="level-btn inactive" onclick="showLevel(3)">Nivel 3</button>
      <button id="btn-level4" class="level-btn inactive" onclick="showLevel(4)">Nivel 4</button>
    </div>
    
    <!-- Nivel 1 -->
    <div id="level1" class="level active">
      <h1>Nivel 1: ¬øQui√©n soy yo? + Verbo To Be</h1>
      <div id="game-box">
        <p><strong>Instrucciones:</strong> Observa el √≠cono y lee el acertijo. Luego elige la opci√≥n correcta con el pronombre y el verbo <em>to be</em>. Al hacer clic, escuchar√°s su pronunciaci√≥n en ingl√©s.</p>
        <div class="image-box" id="emoji1">üë©</div>
        <p class="riddle" id="riddle1">Ella est√° feliz. ¬øQui√©n es?</p>
        <p id="prompt1">Elige la opci√≥n correcta:</p>
        <div class="options" id="options1"></div>
        <p id="feedback1"></p>
        <p id="score1">Puntuaci√≥n: 0</p>
        <p id="final-score1"></p>
        <button id="next-btn1" onclick="nextItem(1)">Siguiente</button>
        <button id="retry-btn1" onclick="restartGame(1)">üîÅ Reintentar</button>
      </div>
    </div>
    
    <!-- Nivel 2 -->
    <div id="level2" class="level">
      <h1>Nivel 2: Completa con el verbo To Be</h1>
      <div id="game-box">
        <p><strong>Instrucciones:</strong> Observa el √≠cono y completa la frase con la opci√≥n correcta. Al hacer clic, escuchar√°s la pronunciaci√≥n en ingl√©s.</p>
        <div class="image-box" id="emoji2">üë¶</div>
        <p class="sentence" id="sentence2">_ a boy.</p>
        <div class="options" id="options2"></div>
        <p id="feedback2"></p>
        <p id="score2">Puntuaci√≥n: 0</p>
        <p id="final-score2"></p>
        <button id="next-btn2" onclick="nextItem(2)">Siguiente</button>
        <button id="retry-btn2" onclick="restartGame(2)">üîÅ Reintentar</button>
        <button id="level3-btn" onclick="showLevel(3)">üöÄ Siguiente nivel</button>
      </div>
    </div>
    
    <!-- Nivel 3 -->
    <div id="level3" class="level">
      <h1>Nivel 3: ¬ø"Am", "Is" o "Are"?</h1>
      <div id="game-box">
        <p><strong>Instrucciones:</strong> Observa el √≠cono y completa la frase con la forma correcta del verbo <em>to be</em>. Al hacer clic, escuchar√°s su pronunciaci√≥n.</p>
        <div class="image-box" id="emoji3">üë©üë©</div>
        <p class="sentence" id="sentence3">Maria and Ana _ friends.</p>
        <div class="options" id="options3"></div>
        <p id="feedback3"></p>
        <p id="score3">Puntuaci√≥n: 0</p>
        <p id="final-score3"></p>
        <button id="next-btn3" onclick="nextItem(3)">Siguiente</button>
        <button id="retry-btn3" onclick="restartGame(3)">üîÅ Reintentar</button>
        <button id="level4-btn" onclick="showLevel(4)">üöÄ Nivel 4</button>
      </div>
    </div>
    
    <!-- Nivel 4 -->
    <div id="level4" class="level">
      <h1>Nivel 4: Completa la historia</h1>
      <div id="game-box">
        <p><strong>Instrucciones:</strong> Lee la historia y elige la opci√≥n correcta para cada espacio. Al hacer clic, escuchar√°s la pronunciaci√≥n. Al final ver√°s tu puntuaci√≥n.</p>
        <div class="story">
          Hello! <select id="q1"><option>Selecciona</option></select> Tom, and I live in a small town with my family.  
          I <select id="q2"><option>Selecciona</option></select> 10 years old and I love playing soccer with my friends.  
          My sister <select id="q3"><option>Selecciona</option></select> Maria. She <select id="q4"><option>Selecciona</option></select> very smart and always helps me with homework.  
          Our parents <select id="q5"><option>Selecciona</option></select> teachers at the local school.  
          We <select id="q6"><option>Selecciona</option></select> very close and enjoy spending time together.  
          Today <select id="q7"><option>Selecciona</option></select> a special day because we <select id="q8"><option>Selecciona</option></select> going to the park for a picnic.
        </div>
        <button id="verify-btn" onclick="checkAnswers()">Verificar respuestas</button>
        <p id="feedback4"></p>
        <p id="score4">Puntuaci√≥n: 0 / 8</p>
        <p id="final-score4"></p>
        <button id="retry-btn4" onclick="restartGame(4)">üîÅ Reintentar</button>
        <button id="show-grade-btn" onclick="calculateFinalGrade()" style="display:none; background-color: #6a11cb;">üìä Ver Calificaci√≥n Final</button>
      </div>
    </div>
    
    <!-- Calificaci√≥n Final -->
    <div id="final-grade">
      <h2>¬°Felicidades! Has completado todos los niveles</h2>
      <p class="grade-message">Tu calificaci√≥n final es:</p>
      <div class="grade-value" id="grade-value">0.0</div>
      <p class="grade-message" id="grade-message"></p>
      <button onclick="restartAllLevels()" style="background-color: white; color: #6a11cb; font-weight: bold;">üîÑ Jugar de Nuevo</button>
    </div>
  </div>

  <script>
    // Variables globales
    let currentScores = {
      1: 0,
      2: 0,
      3: 0,
      4: 0
    };
    
    let maxScores = {
      1: 6,
      2: 6,
      3: 8,
      4: 8
    };
    
    let levelsUnlocked = {
      1: true,
      2: false,
      3: false,
      4: false
    };
    
    let levelsCompleted = {
      1: false,
      2: false,
      3: false,
      4: false
    };
    
    // Datos para cada nivel
    const levelData = {
      1: {
        originalItems: [
          {
            emoji: "üßç",
            answer: "I am",
            riddle: "Estoy hablando de m√≠ mismo. ¬øQui√©n soy?"
          },
          {
            emoji: "üëâ",
            answer: "You are",
            riddle: "Estoy hablando contigo directamente. ¬øQui√©n eres t√∫?"
          },
          {
            emoji: "üë¶",
            answer: "He is",
            riddle: "√âl es un ni√±o que juega f√∫tbol. ¬øQui√©n es?"
          },
          {
            emoji: "üë©",
            answer: "She is",
            riddle: "Ella est√° feliz. ¬øQui√©n es?"
          },
          {
            emoji: "üë´",
            answer: "We are",
            riddle: "T√∫ y yo estamos juntos. ¬øQui√©nes somos?"
          },
          {
            emoji: "üßë‚Äçü§ù‚Äçüßë",
            answer: "They are",
            riddle: "Ellos caminan por el parque. ¬øQui√©nes son?"
          }
        ],
        items: [],
        current: 0,
        score: 0,
        answered: false
      },
      2: {
        originalItems: [
          {
            emoji: "üßç",
            sentence: "_ a student.",
            answer: "I am"
          },
          {
            emoji: "üëâ",
            sentence: "_ my friend.",
            answer: "You are"
          },
          {
            emoji: "üë¶",
            sentence: "_ a boy.",
            answer: "He is"
          },
          {
            emoji: "üë©",
            sentence: "_ a girl.",
            answer: "She is"
          },
          {
            emoji: "üë´",
            sentence: "_ classmates.",
            answer: "We are"
          },
          {
            emoji: "üßë‚Äçü§ù‚Äçüßë",
            sentence: "_ friends.",
            answer: "They are"
          }
        ],
        items: [],
        current: 0,
        score: 0,
        answered: false
      },
      3: {
        originalItems: [
          {
            emoji: "üßç",
            sentence: "I _ a student.",
            answer: "am"
          },
          {
            emoji: "üßç",
            sentence: "I _ happy today.",
            answer: "am"
          },
          {
            emoji: "üë©üë©",
            sentence: "Maria and Ana _ friends.",
            answer: "are"
          },
          {
            emoji: "üë¶",
            sentence: "Tom _ a student.",
            answer: "is"
          },
          {
            emoji: "üë®üë®",
            sentence: "My brothers _ at home.",
            answer: "are"
          },
          {
            emoji: "üë©",
            sentence: "She _ a teacher.",
            answer: "is"
          },
          {
            emoji: "üßçüëâ",
            sentence: "You and I _ classmates.",
            answer: "are"
          },
          {
            emoji: "üë®",
            sentence: "He _ my friend.",
            answer: "is"
          }
        ],
        items: [],
        current: 0,
        score: 0,
        answered: false
      }
    };
    
    // Respuestas correctas para el nivel 4
    const correctAnswers = [
      "I am",  // q1
      "am",    // q2
      "is",    // q3
      "is",    // q4
      "are",   // q5
      "are",   // q6
      "is",    // q7
      "are"    // q8
    ];
    
    const options = ["I am", "You are", "He is", "She is", "We are", "They are", "am", "is", "are"];
    
    // Funci√≥n para mostrar un nivel espec√≠fico
    function showLevel(level) {
      if (!levelsUnlocked[level]) return;
      
      // Ocultar todos los niveles
      document.querySelectorAll('.level').forEach(el => {
        el.classList.remove('active');
      });
      
      // Mostrar el nivel seleccionado
      document.getElementById('level' + level).classList.add('active');
      
      // Actualizar botones de navegaci√≥n
      document.querySelectorAll('.level-btn').forEach((btn, i) => {
        if (i + 1 <= level || levelsUnlocked[i + 1]) {
          btn.classList.remove('inactive');
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
          btn.classList.add('inactive');
        }
      });
    }
    
    // Funci√≥n para mezclar arrays
    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }
    
    // Funci√≥n para pronunciar texto
    function speak(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "en-US";
      speechSynthesis.speak(utterance);
    }
    
    // Funci√≥n para renderizar un elemento en los niveles 1-3
    function renderItem(level) {
      const data = levelData[level];
      const item = data.items[data.current];
      
      document.getElementById("emoji" + level).textContent = item.emoji;
      
      if (level === 1) {
        document.getElementById("riddle" + level).textContent = item.riddle;
      } else {
        document.getElementById("sentence" + level).textContent = item.sentence;
      }
      
      document.getElementById("feedback" + level).textContent = "";
      document.getElementById("final-score" + level).textContent = "";
      document.getElementById("retry-btn" + level).style.display = "none";
      
      if (level === 2 && document.getElementById("level3-btn")) {
        document.getElementById("level3-btn").style.display = "none";
      }
      
      if (level === 3 && document.getElementById("level4-btn")) {
        document.getElementById("level4-btn").style.display = "none";
      }
      
      data.answered = false;
      
      let options;
      if (level === 3) {
        options = ["am", "is", "are"];
      } else {
        options = ["I am", "You are", "He is", "She is", "We are", "They are"];
      }
      
      const container = document.getElementById("options" + level);
      container.innerHTML = "";
      
      options.forEach(p => {
        const btn = document.createElement("button");
        btn.textContent = p;
        btn.onclick = () => {
          speak(p);
          checkAnswer(p, level);
        };
        container.appendChild(btn);
      });
    }
    
    // Funci√≥n para verificar respuesta en niveles 1-3
    function checkAnswer(selected, level) {
      const data = levelData[level];
      
      if (data.answered) return;
      data.answered = true;
      
      const correct = data.items[data.current].answer;
      const feedback = document.getElementById("feedback" + level);
      
      if (selected === correct) {
        feedback.textContent = "‚úÖ ¬°Correcto!";
        feedback.style.color = "green";
        data.score++;
        currentScores[level] = data.score;
      } else {
        feedback.textContent = `‚ùå Ups... era "${correct}".`;
        feedback.style.color = "red";
      }
      
      document.getElementById("score" + level).textContent = `Puntuaci√≥n: ${data.score}`;
    }
    
    // Funci√≥n para pasar al siguiente elemento en niveles 1-3
    function nextItem(level) {
      const data = levelData[level];
      
      if (!data.answered) return;
      
      data.current++;
      if (data.current < data.items.length) {
        renderItem(level);
      } else {
        document.getElementById("final-score" + level).textContent = `üéØ Puntuaci√≥n final: ${data.score} / ${data.items.length}`;
        document.getElementById("next-btn" + level).style.display = "none";
        document.getElementById("retry-btn" + level).style.display = "inline-block";
        
        levelsCompleted[level] = true;
        
        // Habilitar siguiente nivel si se obtuvo buen puntaje
        if (level === 1 && data.score >= 4) { // 4 de 6 (66%)
          levelsUnlocked[2] = true;
          document.getElementById("btn-level2").classList.remove("inactive");
          document.getElementById("btn-level2").classList.add("active");
        } else if (level === 2 && data.score >= 4) { // 4 de 6 (66%)
          levelsUnlocked[3] = true;
          document.getElementById("btn-level3").classList.remove("inactive");
          document.getElementById("btn-level3").classList.add("active");
          document.getElementById("level3-btn").style.display = "inline-block";
        } else if (level === 3 && data.score >= 6) { // 6 de 8 (75%)
          levelsUnlocked[4] = true;
          document.getElementById("btn-level4").classList.remove("inactive");
          document.getElementById("btn-level4").classList.add("active");
          document.getElementById("level4-btn").style.display = "inline-block";
        }
        
        // Verificar si todos los niveles est√°n completados
        checkAllLevelsCompleted();
      }
    }
    
    // Funci√≥n para reiniciar juego en niveles 1-3
    function restartGame(level) {
      const data = levelData[level];
      
      data.items = shuffle([...data.originalItems]);
      data.current = 0;
      data.score = 0;
      currentScores[level] = 0;
      document.getElementById("score" + level).textContent = "Puntuaci√≥n: 0";
      document.getElementById("next-btn" + level).style.display = "inline-block";
      renderItem(level);
    }
    
    // Funciones espec√≠ficas para el nivel 4
    function populateSelects() {
      for (let i = 1; i <= 8; i++) {
        const select = document.getElementById("q" + i);
        select.innerHTML = "<option>Selecciona</option>";
        options.forEach(opt => {
          const option = document.createElement("option");
          option.value = opt;
          option.textContent = opt;
          select.appendChild(option);
        });
        select.onchange = () => speak(select.value);
      }
      document.getElementById("feedback4").textContent = "";
      document.getElementById("score4").textContent = "Puntuaci√≥n: 0 / 8";
      document.getElementById("final-score4").textContent = "";
    }
    
    function checkAnswers() {
      let score = 0;
      for (let i = 1; i <= 8; i++) {
        const selected = document.getElementById("q" + i).value;
        if (selected === correctAnswers[i - 1]) {
          score++;
        }
      }
      
      currentScores[4] = score;
      levelsCompleted[4] = true;
      
      const feedback = document.getElementById("feedback4");
      if (score === 8) {
        feedback.textContent = "üéâ ¬°Excelente! Completaste toda la historia correctamente.";
        feedback.style.color = "green";
      } else if (score >= 5) {
        feedback.textContent = "üëç ¬°Muy bien! Solo faltan algunos detalles.";
        feedback.style.color = "orange";
      } else {
        feedback.textContent = "üòÖ Intenta de nuevo. Revisa los pronombres y el verbo to be.";
        feedback.style.color = "red";
      }
      
      document.getElementById("score4").textContent = `Puntuaci√≥n: ${score} / 8`;
      document.getElementById("final-score4").textContent = "Historia completada.";
      document.getElementById("show-grade-btn").style.display = "inline-block";
      
      // Verificar si todos los niveles est√°n completados
      checkAllLevelsCompleted();
    }
    
    // Verificar si todos los niveles est√°n completados
    function checkAllLevelsCompleted() {
      const allCompleted = Object.values(levelsCompleted).every(completed => completed);
      if (allCompleted) {
        document.getElementById("show-grade-btn").style.display = "inline-block";
      }
    }
    
    // Calcular la calificaci√≥n final
    function calculateFinalGrade() {
      let totalScore = 0;
      let totalMaxScore = 0;
      
      for (let level = 1; level <= 4; level++) {
        totalScore += currentScores[level];
        totalMaxScore += maxScores[level];
      }
      
      // Calcular la calificaci√≥n en escala de 0 a 10 con un decimal
      const grade = (totalScore / totalMaxScore) * 10;
      const roundedGrade = Math.round(grade * 10) / 10;
      
      // Determinar el mensaje seg√∫n la calificaci√≥n
      let message = "";
      if (roundedGrade >= 9) {
        message = "¬°Excelente! Dominas el verbo To Be perfectamente.";
      } else if (roundedGrade >= 7) {
        message = "¬°Muy bien! Tienes un buen conocimiento del verbo To Be.";
      } else if (roundedGrade >= 5) {
        message = "¬°Bien hecho! Con un poco m√°s de pr√°ctica mejorar√°s.";
      } else {
        message = "Sigue practicando, lo conseguir√°s.";
      }
      
      // Mostrar la calificaci√≥n
      document.getElementById("grade-value").textContent = roundedGrade;
      document.getElementById("grade-message").textContent = message;
      document.getElementById("final-grade").style.display = "block";
      
      // Desplazar hacia la calificaci√≥n
      document.getElementById("final-grade").scrollIntoView({ behavior: 'smooth' });
    }
    
    // Reiniciar todos los niveles
    function restartAllLevels() {
      // Reiniciar niveles 1-3
      for (let level = 1; level <= 3; level++) {
        levelData[level].items = shuffle([...levelData[level].originalItems]);
        levelData[level].current = 0;
        levelData[level].score = 0;
        levelData[level].answered = false;
        currentScores[level] = 0;
        levelsCompleted[level] = false;
        
        document.getElementById("score" + level).textContent = "Puntuaci√≥n: 0";
        document.getElementById("next-btn" + level).style.display = "inline-block";
        document.getElementById("retry-btn" + level).style.display = "none";
        document.getElementById("final-score" + level).textContent = "";
      }
      
      // Reiniciar nivel 4
      currentScores[4] = 0;
      levelsCompleted[4] = false;
      populateSelects();
      document.getElementById("show-grade-btn").style.display = "none";
      
      // Reiniciar estado de niveles desbloqueados
      levelsUnlocked = {
        1: true,
        2: false,
        3: false,
        4: false
      };
      
      // Ocultar calificaci√≥n final
      document.getElementById("final-grade").style.display = "none";
      
      // Mostrar solo el nivel 1
      showLevel(1);
      
      // Actualizar botones de navegaci√≥n
      document.querySelectorAll('.level-btn').forEach((btn, i) => {
        if (i === 0) {
          btn.classList.remove('inactive');
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
          btn.classList.add('inactive');
        }
      });
    }
    
    // Inicializaci√≥n
    function init() {
      // Inicializar niveles 1-3
      for (let level = 1; level <= 3; level++) {
        levelData[level].items = shuffle([...levelData[level].originalItems]);
        renderItem(level);
      }
      
      // Inicializar nivel 4
      populateSelects();
      
      // Mostrar solo el nivel 1 inicialmente
      showLevel(1);
    }
    
    // Ejecutar inicializaci√≥n cuando se cargue la p√°gina
    window.onload = init;
  </script>
</body>
</html>
